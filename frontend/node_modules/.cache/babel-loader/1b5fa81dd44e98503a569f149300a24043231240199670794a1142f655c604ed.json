{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst clamp_1 = __importDefault(require(\"clamp\"));\nconst utils_1 = __importDefault(require(\"../utils\"));\nconst eval_1 = require(\"../helpers/eval\");\nfunction checkAsymptote(d0, d1, d, sign, level) {\n  if (!level) {\n    return {\n      asymptote: true,\n      d0: d0,\n      d1: d1\n    };\n  }\n  const n = 10;\n  const x0 = d0[0];\n  const x1 = d1[0];\n  const samples = utils_1.default.linspace(x0, x1, n);\n  let oldY, oldX;\n  for (let i = 0; i < n; i += 1) {\n    const x = samples[i];\n    const y = (0, eval_1.builtIn)(d, 'fn', {\n      x: x\n    });\n    if (i && oldY) {\n      const deltaY = y - oldY;\n      const newSign = utils_1.default.sgn(deltaY);\n      if (newSign === sign) {\n        return checkAsymptote([oldX, oldY], [x, y], d, sign, level - 1);\n      }\n    }\n    oldY = y;\n    oldX = x;\n  }\n  return {\n    asymptote: false,\n    d0: d0,\n    d1: d1\n  };\n}\n/**\n * Splits the evaluated data into arrays, each array is separated by any asymptote found\n * through the process of detecting slope/sign brusque changes\n * @param chart\n * @param d\n * @param data\n * @returns {Array[]}\n */\nfunction split(chart, d, data) {\n  let i, oldSign;\n  let deltaX;\n  let st = [];\n  const sets = [];\n  const domain = chart.meta.yScale.domain();\n  const yMin = domain[0];\n  const yMax = domain[1];\n  if (data[0]) {\n    st.push(data[0]);\n    deltaX = data[1][0] - data[0][0];\n    oldSign = utils_1.default.sgn(data[1][1] - data[0][1]);\n  }\n  function updateY(d) {\n    d[1] = Math.min(d[1], yMax);\n    d[1] = Math.max(d[1], yMin);\n    return d;\n  }\n  i = 1;\n  while (i < data.length) {\n    const y0 = data[i - 1][1];\n    const y1 = data[i][1];\n    const deltaY = y1 - y0;\n    const newSign = utils_1.default.sgn(deltaY);\n    // make a new set if:\n    if (\n    // utils.sgn(y1) * utils.sgn(y0) < 0 && // there's a change in the evaluated values sign\n    // there's a change in the slope sign\n    oldSign !== newSign &&\n    // the slope is bigger to some value (according to the current zoom scale)\n    Math.abs(deltaY / deltaX) > 1 / 1) {\n      // retest this section again and determine if it's an asymptote\n      const check = checkAsymptote(data[i - 1], data[i], d, newSign, 3);\n      if (check.asymptote) {\n        st.push(updateY(check.d0));\n        sets.push(st);\n        st = [updateY(check.d1)];\n      }\n    }\n    oldSign = newSign;\n    st.push(data[i]);\n    ++i;\n  }\n  if (st.length) {\n    sets.push(st);\n  }\n  return sets;\n}\nfunction linear(chart, d, range, n) {\n  const allX = utils_1.default.space(chart, range, n);\n  const yDomain = chart.meta.yScale.domain();\n  const yDomainMargin = yDomain[1] - yDomain[0];\n  const yMin = yDomain[0] - yDomainMargin * 1e5;\n  const yMax = yDomain[1] + yDomainMargin * 1e5;\n  let data = [];\n  for (let i = 0; i < allX.length; i += 1) {\n    const x = allX[i];\n    const y = (0, eval_1.builtIn)(d, 'fn', {\n      x: x\n    });\n    if (utils_1.default.isValidNumber(x) && utils_1.default.isValidNumber(y)) {\n      data.push([x, (0, clamp_1.default)(y, yMin, yMax)]);\n    }\n  }\n  data = split(chart, d, data);\n  return data;\n}\nfunction parametric(chart, d, range, nSamples) {\n  // range is mapped to canvas coordinates from the input\n  // for parametric plots the range will tell the start/end points of the `t` param\n  const parametricRange = d.range || [0, 2 * Math.PI];\n  const tCoords = utils_1.default.space(chart, parametricRange, nSamples);\n  const samples = [];\n  for (let i = 0; i < tCoords.length; i += 1) {\n    const t = tCoords[i];\n    const x = (0, eval_1.builtIn)(d, 'x', {\n      t: t\n    });\n    const y = (0, eval_1.builtIn)(d, 'y', {\n      t: t\n    });\n    samples.push([x, y]);\n  }\n  return [samples];\n}\nfunction polar(chart, d, range, nSamples) {\n  // range is mapped to canvas coordinates from the input\n  // for polar plots the range will tell the start/end points of the `theta` param\n  const polarRange = d.range || [-Math.PI, Math.PI];\n  const thetaSamples = utils_1.default.space(chart, polarRange, nSamples);\n  const samples = [];\n  for (let i = 0; i < thetaSamples.length; i += 1) {\n    const theta = thetaSamples[i];\n    const r = (0, eval_1.builtIn)(d, 'r', {\n      theta: theta\n    });\n    const x = r * Math.cos(theta);\n    const y = r * Math.sin(theta);\n    samples.push([x, y]);\n  }\n  return [samples];\n}\nfunction points(chart, d, range, nSamples) {\n  return [d.points];\n}\nfunction vector(chart, d, range, nSamples) {\n  d.offset = d.offset || [0, 0];\n  return [[d.offset, [d.vector[0] + d.offset[0], d.vector[1] + d.offset[1]]]];\n}\nconst sampler = function (chart, d, range, nSamples) {\n  const fnTypes = {\n    parametric: parametric,\n    polar: polar,\n    points: points,\n    vector: vector,\n    linear: linear\n  };\n  if (!(d.fnType in fnTypes)) {\n    throw Error(d.fnType + ' is not supported in the `builtIn` sampler');\n  }\n  // @ts-ignore\n  return fnTypes[d.fnType].apply(null, arguments);\n};\nexports.default = sampler;","map":{"version":3,"names":["clamp_1","__importDefault","require","utils_1","eval_1","checkAsymptote","d0","d1","d","sign","level","asymptote","n","x0","x1","samples","default","linspace","oldY","oldX","i","x","y","builtIn","deltaY","newSign","sgn","split","chart","data","oldSign","deltaX","st","sets","domain","meta","yScale","yMin","yMax","push","updateY","Math","min","max","length","y0","y1","abs","check","linear","range","allX","space","yDomain","yDomainMargin","isValidNumber","parametric","nSamples","parametricRange","PI","tCoords","t","polar","polarRange","thetaSamples","theta","r","cos","sin","points","vector","offset","sampler","fnTypes","fnType","Error","apply","arguments","exports"],"sources":["../../src/samplers/builtIn.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst d3_selection_1 = require(\"d3-selection\");\nconst graph_types_1 = require(\"../graph-types/\");\nconst eval_1 = require(\"./eval\");\nconst datum_defaults_1 = __importDefault(require(\"../datum-defaults\"));\nfunction derivative(chart) {\n  const derivativeDatum = (0, datum_defaults_1.default)({\n    isHelper: true,\n    skipTip: true,\n    skipBoundsCheck: true,\n    nSamples: 2,\n    graphType: 'polyline'\n  });\n  function computeLine(d) {\n    if (!d.derivative) {\n      return [];\n    }\n    const x0 = typeof d.derivative.x0 === 'number' ? d.derivative.x0 : Infinity;\n    derivativeDatum.index = d.index;\n    derivativeDatum.scope = {\n      m: (0, eval_1.builtIn)(d.derivative, 'fn', {\n        x: x0\n      }),\n      x0: x0,\n      y0: (0, eval_1.builtIn)(d, 'fn', {\n        x: x0\n      })\n    };\n    derivativeDatum.fn = 'm * (x - x0) + y0';\n    return [derivativeDatum];\n  }\n  function checkAutoUpdate(d) {\n    const self = this;\n    if (!d.derivative) {\n      return;\n    }\n    if (d.derivative.updateOnMouseMove && !d.derivative.$$mouseListener) {\n      d.derivative.$$mouseListener = function ({\n        x\n      }) {\n        // update initial value to be the position of the mouse\n        // scope's x0 will be updated on the next call to `derivative(self)`\n        if (d.derivative) {\n          d.derivative.x0 = x;\n        }\n        // trigger update (selection = self)\n        derivative(self);\n      };\n      // if d.derivative is destroyed and recreated, the tip:update event\n      // will be fired on the new d.derivative :)\n      chart.on('tip:update', d.derivative.$$mouseListener);\n    }\n  }\n  const derivative = function (selection) {\n    selection.each(function (d) {\n      const el = (0, d3_selection_1.select)(this);\n      const data = computeLine.call(selection, d);\n      checkAutoUpdate.call(selection, d);\n      const innerSelection = el.selectAll('g.derivative').data(data);\n      const innerSelectionEnter = innerSelection.enter().append('g').attr('class', 'derivative');\n      // enter + update\n      innerSelection.merge(innerSelectionEnter).call((0, graph_types_1.polyline)(chart));\n      // update\n      // change the opacity of the line\n      innerSelection.merge(innerSelectionEnter).selectAll('path').attr('opacity', 0.5);\n      innerSelection.exit().remove();\n    });\n  };\n  return derivative;\n}\nexports.default = derivative;","map":{"version":3,"names":["d3_selection_1","require","graph_types_1","eval_1","datum_defaults_1","__importDefault","derivative","chart","derivativeDatum","default","isHelper","skipTip","skipBoundsCheck","nSamples","graphType","computeLine","d","x0","Infinity","index","scope","m","builtIn","x","y0","fn","checkAutoUpdate","self","updateOnMouseMove","$$mouseListener","on","selection","each","el","select","data","call","innerSelection","selectAll","innerSelectionEnter","enter","append","attr","merge","polyline","exit","remove","exports"],"sources":["../../src/helpers/derivative.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst d3_selection_1 = require(\"d3-selection\");\nconst eval_1 = require(\"./eval\");\nconst datum_defaults_1 = __importDefault(require(\"../datum-defaults\"));\nconst graph_types_1 = require(\"../graph-types/\");\nfunction secant(chart) {\n  const secantDefaults = (0, datum_defaults_1.default)({\n    isHelper: true,\n    skipTip: true,\n    skipBoundsCheck: true,\n    nSamples: 2,\n    graphType: 'polyline'\n  });\n  function computeSlope(scope) {\n    scope.m = (scope.y1 - scope.y0) / (scope.x1 - scope.x0);\n  }\n  function updateLine(d, secant) {\n    if (!('x0' in secant)) {\n      throw Error('secant must have the property `x0` defined');\n    }\n    secant.scope = secant.scope || {};\n    const x0 = secant.x0;\n    const x1 = typeof secant.x1 === 'number' ? secant.x1 : Infinity;\n    Object.assign(secant.scope, {\n      x0: x0,\n      x1: x1,\n      y0: (0, eval_1.builtIn)(d, 'fn', {\n        x: x0\n      }),\n      y1: (0, eval_1.builtIn)(d, 'fn', {\n        x: x1\n      })\n    });\n    computeSlope(secant.scope);\n  }\n  function setFn(d, secant) {\n    updateLine(d, secant);\n    secant.fn = 'm * (x - x0) + y0';\n  }\n  function setMouseListener(d, secantObject) {\n    const self = this;\n    if (secantObject.updateOnMouseMove && !secantObject.$$mouseListener) {\n      secantObject.$$mouseListener = function ({\n        x\n      }) {\n        secantObject.x1 = x;\n        updateLine(d, secantObject);\n        secant(self);\n      };\n      chart.on('tip:update', secantObject.$$mouseListener);\n    }\n  }\n  function computeLines(d) {\n    const self = this;\n    const data = [];\n    d.secants = d.secants || [];\n    for (let i = 0; i < d.secants.length; i += 1) {\n      const secant = d.secants[i] = Object.assign({}, secantDefaults, d.secants[i]);\n      // necessary to make the secant have the same color as d\n      secant.index = d.index;\n      if (!secant.fn) {\n        setFn.call(self, d, secant);\n        setMouseListener.call(self, d, secant);\n      }\n      data.push(secant);\n    }\n    return data;\n  }\n  const secant = function (selection) {\n    selection.each(function (d) {\n      const el = (0, d3_selection_1.select)(this);\n      const data = computeLines.call(selection, d);\n      const innerSelection = el.selectAll('g.secant').data(data);\n      const innerSelectionEnter = innerSelection.enter().append('g').attr('class', 'secant');\n      // enter + update\n      innerSelection.merge(innerSelectionEnter).call((0, graph_types_1.polyline)(chart));\n      // change the opacity of the secants\n      innerSelection.merge(innerSelectionEnter).selectAll('path').attr('opacity', 0.5);\n      // exit\n      innerSelection.exit().remove();\n    });\n  };\n  return secant;\n}\nexports.default = secant;","map":{"version":3,"names":["d3_selection_1","require","eval_1","datum_defaults_1","__importDefault","graph_types_1","secant","chart","secantDefaults","default","isHelper","skipTip","skipBoundsCheck","nSamples","graphType","computeSlope","scope","m","y1","y0","x1","x0","updateLine","d","Error","Infinity","Object","assign","builtIn","x","setFn","fn","setMouseListener","secantObject","self","updateOnMouseMove","$$mouseListener","on","computeLines","data","secants","i","length","index","call","push","selection","each","el","select","innerSelection","selectAll","innerSelectionEnter","enter","append","attr","merge","polyline","exit","remove","exports"],"sources":["../../src/helpers/secant.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
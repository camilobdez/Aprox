{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst interval_arithmetic_eval_1 = __importStar(require(\"interval-arithmetic-eval\"));\nconst eval_1 = require(\"../helpers/eval\");\nconst utils_1 = __importDefault(require(\"../utils\"));\n// const Interval = (intervalArithmeticEval as any).Interval\n// disable the use of typed arrays in interval-arithmetic to improve the performance\ninterval_arithmetic_eval_1.default.policies.disableRounding();\nfunction interval1d(chart, d, range, nSamples) {\n  const xCoords = utils_1.default.space(chart, range, nSamples);\n  const xScale = chart.meta.xScale;\n  const yScale = chart.meta.yScale;\n  const yMin = yScale.domain()[0];\n  const yMax = yScale.domain()[1];\n  const samples = [];\n  let i;\n  for (i = 0; i < xCoords.length - 1; i += 1) {\n    const x = {\n      lo: xCoords[i],\n      hi: xCoords[i + 1]\n    };\n    const y = (0, eval_1.interval)(d, 'fn', {\n      x: x\n    });\n    if (!interval_arithmetic_eval_1.Interval.isEmpty(y) && !interval_arithmetic_eval_1.Interval.isWhole(y)) {\n      samples.push([x, y]);\n    }\n    if (interval_arithmetic_eval_1.Interval.isWhole(y)) {\n      // means that the next and prev intervals need to be fixed\n      samples.push(null);\n    }\n  }\n  // asymptote determination\n  for (i = 1; i < samples.length - 1; i += 1) {\n    if (!samples[i]) {\n      const prev = samples[i - 1];\n      const next = samples[i + 1];\n      if (prev && next && !interval_arithmetic_eval_1.Interval.intervalsOverlap(prev[1], next[1])) {\n        // case:\n        //\n        //   |\n        //\n        //     |\n        //\n        //   p n\n        if (prev[1].lo > next[1].hi) {\n          prev[1].hi = Math.max(yMax, prev[1].hi);\n          next[1].lo = Math.min(yMin, next[1].lo);\n        }\n        // case:\n        //\n        //     |\n        //\n        //   |\n        //\n        //   p n\n        if (prev[1].hi < next[1].lo) {\n          prev[1].lo = Math.min(yMin, prev[1].lo);\n          next[1].hi = Math.max(yMax, next[1].hi);\n        }\n      }\n    }\n  }\n  samples.scaledDx = xScale(xCoords[1]) - xScale(xCoords[0]);\n  return [samples];\n}\nlet rectEps;\nfunction smallRect(x, y) {\n  return interval_arithmetic_eval_1.Interval.width(x) < rectEps;\n}\nfunction quadTree(x, y, meta) {\n  const sample = (0, eval_1.interval)(meta, 'fn', {\n    x: x,\n    y: y\n  });\n  const fulfills = interval_arithmetic_eval_1.Interval.zeroIn(sample);\n  if (!fulfills) {\n    return this;\n  }\n  if (smallRect(x, y)) {\n    this.push([x, y]);\n    return this;\n  }\n  const midX = x.lo + (x.hi - x.lo) / 2;\n  const midY = y.lo + (y.hi - y.lo) / 2;\n  const east = {\n    lo: midX,\n    hi: x.hi\n  };\n  const west = {\n    lo: x.lo,\n    hi: midX\n  };\n  const north = {\n    lo: midY,\n    hi: y.hi\n  };\n  const south = {\n    lo: y.lo,\n    hi: midY\n  };\n  quadTree.call(this, east, north, meta);\n  quadTree.call(this, east, south, meta);\n  quadTree.call(this, west, north, meta);\n  quadTree.call(this, west, south, meta);\n}\nfunction interval2d(chart, meta) {\n  const xScale = chart.meta.xScale;\n  const xDomain = chart.meta.xScale.domain();\n  const yDomain = chart.meta.yScale.domain();\n  const x = {\n    lo: xDomain[0],\n    hi: xDomain[1]\n  };\n  const y = {\n    lo: yDomain[0],\n    hi: yDomain[1]\n  };\n  const samples = [];\n  // 1 px\n  rectEps = xScale.invert(1) - xScale.invert(0);\n  quadTree.call(samples, x, y, meta);\n  samples.scaledDx = 1;\n  return [samples];\n}\nconst sampler = function (chart, d, range, nSamples) {\n  const fnTypes = {\n    implicit: interval2d,\n    linear: interval1d\n  };\n  if (!fnTypes.hasOwnProperty(d.fnType)) {\n    throw Error(d.fnType + ' is not supported in the `interval` sampler');\n  }\n  // @ts-ignore\n  return fnTypes[d.fnType].apply(null, arguments);\n};\nexports.default = sampler;","map":{"version":3,"names":["interval_arithmetic_eval_1","__importStar","require","eval_1","utils_1","__importDefault","default","policies","disableRounding","interval1d","chart","d","range","nSamples","xCoords","space","xScale","meta","yScale","yMin","domain","yMax","samples","i","length","x","lo","hi","y","interval","Interval","isEmpty","isWhole","push","prev","next","intervalsOverlap","Math","max","min","scaledDx","rectEps","smallRect","width","quadTree","sample","fulfills","zeroIn","midX","midY","east","west","north","south","call","interval2d","xDomain","yDomain","invert","sampler","fnTypes","implicit","linear","hasOwnProperty","fnType","Error","apply","arguments","exports"],"sources":["../../src/samplers/interval.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst d3_shape_1 = require(\"d3-shape\");\nconst d3_selection_1 = require(\"d3-selection\");\nconst clamp_1 = __importDefault(require(\"clamp\"));\nconst utils_1 = __importDefault(require(\"./utils\"));\nconst globals_1 = __importDefault(require(\"./globals\"));\nconst eval_1 = require(\"./helpers/eval\");\nfunction mouseTip(config) {\n  config = Object.assign({\n    xLine: false,\n    yLine: false,\n    renderer: function (x, y) {\n      return '(' + x.toFixed(3) + ', ' + y.toFixed(3) + ')';\n    },\n    owner: null\n  }, config);\n  const MARGIN = 20;\n  const line = (0, d3_shape_1.line)().x(function (d) {\n    return d[0];\n  }).y(function (d) {\n    return d[1];\n  });\n  function lineGenerator(el, data) {\n    return el.append('path').datum(data).attr('stroke', 'grey').attr('stroke-dasharray', '5,5').attr('opacity', 0.5).attr('d', line);\n  }\n  let tipInnerJoin, tipInnerEnter;\n  function tip(selection) {\n    const join = selection.selectAll('g.tip').data(function (d) {\n      return [d];\n    });\n    // enter\n    const tipEnter = join.enter().append('g').attr('class', 'tip').attr('clip-path', 'url(#function-plot-clip-' + config.owner.id + ')');\n    // enter + update = enter inner tip\n    tipInnerJoin = join.merge(tipEnter).selectAll('g.inner-tip').data(function (d) {\n      // debugger\n      return [d];\n    });\n    tipInnerEnter = tipInnerJoin.enter().append('g').attr('class', 'inner-tip').style('display', 'none').each(function () {\n      const el = (0, d3_selection_1.select)(this);\n      lineGenerator(el, [[0, -config.owner.meta.height - MARGIN], [0, config.owner.meta.height + MARGIN]]).attr('class', 'tip-x-line').style('display', 'none');\n      lineGenerator(el, [[-config.owner.meta.width - MARGIN, 0], [config.owner.meta.width + MARGIN, 0]]).attr('class', 'tip-y-line').style('display', 'none');\n      el.append('circle').attr('r', 3);\n      el.append('text').attr('transform', 'translate(5,-5)');\n    });\n    // enter + update\n    tipInnerJoin.merge(tipInnerEnter).selectAll('.tip-x-line').style('display', config.xLine ? null : 'none');\n    tipInnerJoin.merge(tipInnerEnter).selectAll('.tip-y-line').style('display', config.yLine ? null : 'none');\n  }\n  tip.move = function (coordinates) {\n    let i;\n    let minDist = Infinity;\n    let closestIndex = -1;\n    let x, y;\n    const selection = tipInnerJoin.merge(tipInnerEnter);\n    const inf = 1e8;\n    const meta = config.owner.meta;\n    const data = selection.datum().data;\n    const xScale = meta.xScale;\n    const yScale = meta.yScale;\n    const width = meta.width;\n    const height = meta.height;\n    const x0 = coordinates.x;\n    const y0 = coordinates.y;\n    for (i = 0; i < data.length; i += 1) {\n      // skipTip=true skips the evaluation in the datum\n      // implicit equations cannot be evaluated with a single point\n      // parametric equations cannot be evaluated with a single point\n      // polar equations cannot be evaluated with a single point\n      if (data[i].skipTip || data[i].fnType !== 'linear') {\n        continue;\n      }\n      const range = data[i].range || [-inf, inf];\n      let candidateY;\n      if (x0 > range[0] - globals_1.default.TIP_X_EPS && x0 < range[1] + globals_1.default.TIP_X_EPS) {\n        try {\n          candidateY = (0, eval_1.builtIn)(data[i], 'fn', {\n            x: x0\n          });\n        } catch (e) {}\n        if (utils_1.default.isValidNumber(candidateY)) {\n          const tDist = Math.abs(candidateY - y0);\n          if (tDist < minDist) {\n            minDist = tDist;\n            closestIndex = i;\n          }\n        }\n      }\n    }\n    if (closestIndex !== -1) {\n      x = x0;\n      if (data[closestIndex].range) {\n        x = Math.max(x, data[closestIndex].range[0]);\n        x = Math.min(x, data[closestIndex].range[1]);\n      }\n      y = (0, eval_1.builtIn)(data[closestIndex], 'fn', {\n        x: x\n      });\n      tip.show();\n      config.owner.emit('tip:update', {\n        x,\n        y,\n        index: closestIndex\n      });\n      // @ts-ignore\n      const clampX = (0, clamp_1.default)(x, xScale.invert(-MARGIN), xScale.invert(width + MARGIN));\n      // @ts-ignore\n      const clampY = (0, clamp_1.default)(y, yScale.invert(height + MARGIN), yScale.invert(-MARGIN));\n      const color = utils_1.default.color(data[closestIndex], closestIndex);\n      selection.style('color', 'red');\n      selection.attr('transform', 'translate(' + xScale(clampX) + ',' + yScale(clampY) + ')');\n      selection.select('circle').attr('fill', color);\n      selection.select('text').attr('fill', color).text(config.renderer(x, y, closestIndex));\n    } else {\n      tip.hide();\n    }\n  };\n  tip.show = function () {\n    tipInnerJoin.merge(tipInnerEnter).style('display', null);\n  };\n  tip.hide = function () {\n    tipInnerJoin.merge(tipInnerEnter).style('display', 'none');\n  };\n  // generations of getters/setters\n  Object.keys(config).forEach(function (option) {\n    utils_1.default.getterSetter.call(tip, config, option);\n  });\n  return tip;\n}\nexports.default = mouseTip;","map":{"version":3,"names":["d3_shape_1","require","d3_selection_1","clamp_1","__importDefault","utils_1","globals_1","eval_1","mouseTip","config","Object","assign","xLine","yLine","renderer","x","y","toFixed","owner","MARGIN","line","d","lineGenerator","el","data","append","datum","attr","tipInnerJoin","tipInnerEnter","tip","selection","join","selectAll","tipEnter","enter","id","merge","style","each","select","meta","height","width","move","coordinates","i","minDist","Infinity","closestIndex","inf","xScale","yScale","x0","y0","length","skipTip","fnType","range","candidateY","default","TIP_X_EPS","builtIn","e","isValidNumber","tDist","Math","abs","max","min","show","emit","index","clampX","invert","clampY","color","text","hide","keys","forEach","option","getterSetter","call","exports"],"sources":["../src/tip.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst d3_selection_1 = require(\"d3-selection\");\nconst d3_shape_1 = require(\"d3-shape\");\nconst clamp_1 = __importDefault(require(\"clamp\"));\nconst utils_1 = __importDefault(require(\"../utils\"));\nconst evaluate_1 = __importDefault(require(\"../evaluate\"));\nfunction polyline(chart) {\n  function plotLine(selection) {\n    selection.each(function (d) {\n      const el = plotLine.el = (0, d3_selection_1.select)(this);\n      const index = d.index;\n      const evaluatedData = (0, evaluate_1.default)(chart, d);\n      const color = utils_1.default.color(d, index);\n      // join\n      const innerSelection = el.selectAll(':scope > path.line').data(evaluatedData);\n      const yRange = chart.meta.yScale.range();\n      let yMax = yRange[0];\n      let yMin = yRange[1];\n      // workaround, clamp assuming that the bounds are finite but huge\n      const diff = yMax - yMin;\n      yMax += diff * 1e6;\n      yMin -= diff * 1e6;\n      if (d.skipBoundsCheck) {\n        yMax = Infinity;\n        yMin = -Infinity;\n      }\n      function y(d) {\n        return (0, clamp_1.default)(chart.meta.yScale(d[1]), yMin, yMax);\n      }\n      const line = (0, d3_shape_1.line)().curve(d3_shape_1.curveLinear).x(function (d) {\n        return chart.meta.xScale(d[0]);\n      }).y(y);\n      const area = (0, d3_shape_1.area)().x(function (d) {\n        return chart.meta.yScale(d[0]);\n      }).y0(chart.meta.yScale(0)).y1(y);\n      const cls = `line line-${index}`;\n      const innerSelectionEnter = innerSelection.enter().append('path').attr('class', cls).attr('stroke-width', 1).attr('stroke-linecap', 'round');\n      // enter + update\n      innerSelection.merge(innerSelectionEnter).each(function () {\n        const path = (0, d3_selection_1.select)(this);\n        let pathD;\n        if (d.closed) {\n          path.attr('fill', color);\n          path.attr('fill-opacity', 0.3);\n          pathD = area;\n        } else {\n          path.attr('fill', 'none');\n          pathD = line;\n        }\n        path.attr('stroke', color).attr('marker-end', function () {\n          // special marker for vectors\n          return d.fnType === 'vector' ? 'url(#' + chart.markerId + ')' : null;\n        }).attr('d', pathD);\n        if (d.attr) {\n          for (const k in d.attr) {\n            // If the attribute to modify is class then append the default class\n            // or otherwise the d3 selection won't work.\n            let val = d.attr[k];\n            if (k === 'class') {\n              val = `${cls} ${d.attr[k]}`;\n            }\n            path.attr(k, val);\n          }\n        }\n      });\n      // exit\n      innerSelection.exit().remove();\n    });\n  }\n  return plotLine;\n}\nexports.default = polyline;","map":{"version":3,"names":["d3_selection_1","require","d3_shape_1","clamp_1","__importDefault","utils_1","evaluate_1","polyline","chart","plotLine","selection","each","d","el","select","index","evaluatedData","default","color","innerSelection","selectAll","data","yRange","meta","yScale","range","yMax","yMin","diff","skipBoundsCheck","Infinity","y","line","curve","curveLinear","x","xScale","area","y0","y1","cls","innerSelectionEnter","enter","append","attr","merge","path","pathD","closed","fnType","markerId","k","val","exit","remove","exports"],"sources":["../../src/graph-types/polyline.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}